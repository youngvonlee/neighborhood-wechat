<!-- pages/community/activity/detail/detail.wxml -->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ´»åŠ¨è¯¦æƒ… -->
  <view class="activity-detail" wx:else>
    <!-- æ´»åŠ¨å°é¢ -->
    <image class="activity-cover" src="{{activity.image}}" mode="aspectFill"></image>
    
    <!-- æ´»åŠ¨æ ‡é¢˜å’ŒçŠ¶æ€ -->
    <view class="activity-header">
      <view class="activity-title">{{activity.title}}</view>
      <view class="activity-status {{activity.status === 'æŠ¥åä¸­' ? 'status-enrolling' : 'status-ended'}}">{{activity.status}}</view>
    </view>
    
    <!-- æ´»åŠ¨ä¿¡æ¯ -->
    <view class="info-section">
      <view class="info-item">
        <image class="info-icon" src="/static/icons/time.svg"></image>
        <text class="info-text">{{activity.time}}</text>
      </view>
      <view class="info-item">
        <image class="info-icon" src="/static/icons/location.svg"></image>
        <text class="info-text">{{activity.location}}</text>
      </view>
      <view class="info-item">
        <image class="info-icon" src="/static/icons/user.svg"></image>
        <text class="info-text">å·²æŠ¥å {{activity.participantsCount}}/{{activity.maxParticipants}} äºº</text>
      </view>
      <view class="info-item" wx:if="{{activity.fee > 0}}">
        <image class="info-icon" src="/static/icons/money.svg"></image>
        <text class="info-text">è´¹ç”¨: {{activity.fee}}å…ƒ/äºº</text>
      </view>
      <view class="info-item" wx:else>
        <image class="info-icon" src="/static/icons/money.svg"></image>
        <text class="info-text">å…è´¹æ´»åŠ¨</text>
      </view>
    </view>
    
    <!-- æ´»åŠ¨æ ‡ç­¾ -->
    <view class="tags-section">
      <view class="tag" wx:for="{{activity.tags}}" wx:key="*this">{{item}}</view>
    </view>
    
    <!-- æ´»åŠ¨æè¿° -->
    <view class="section">
      <view class="section-title">æ´»åŠ¨è¯¦æƒ…</view>
      <view class="section-content">
        <text class="description">{{activity.description}}</text>
      </view>
    </view>
    
    <!-- æºå¸¦ç‰©å“ -->
    <view class="section">
      <view class="section-title">æºå¸¦ç‰©å“</view>
      <view class="section-content">
        <text>{{activity.materials}}</text>
      </view>
    </view>
    
    <!-- æ´»åŠ¨é¡»çŸ¥ -->
    <view class="section">
      <view class="section-title">æ´»åŠ¨é¡»çŸ¥</view>
      <view class="section-content">
        <text>{{activity.notice}}</text>
      </view>
    </view>
    
    <!-- ç»„ç»‡è€…ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">ç»„ç»‡è€…ä¿¡æ¯</view>
      <view class="section-content">
        <view class="organizer-info">
          <text>ç»„ç»‡å•ä½ï¼š{{activity.organizer}}</text>
          <text>è”ç³»äººï¼š{{activity.contactPerson}}</text>
          <view class="contact-phone" bindtap="callOrganizer">
            <text>è”ç³»ç”µè¯ï¼š{{activity.contactPhone}}</text>
            <image class="phone-icon" src="/static/icons/phone.svg"></image>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å·²æŠ¥åç”¨æˆ· -->
    <view class="section">
      <view class="section-title">å·²æŠ¥åç”¨æˆ·</view>
      <view class="section-content">
        <view class="participants-list">
          <view class="participant" wx:for="{{activity.participants}}" wx:key="id">
            <image class="participant-avatar" src="{{item.avatar}}"></image>
            <text class="participant-name">{{item.nickname}}</text>
          </view>
          <view class="participant more" wx:if="{{activity.participantsCount > 3}}">
            <text>+{{activity.participantsCount - 3}}äºº</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è¯„è®ºåŒº -->
    <view class="section">
      <view class="section-title">æ´»åŠ¨è¯„è®º ({{comments.length}})</view>
      <view class="section-content">
        <view class="comments-list">
          <view class="comment" wx:for="{{comments}}" wx:key="id">
            <image class="comment-avatar" src="{{item.user.avatar}}"></image>
            <view class="comment-content">
              <view class="comment-header">
                <text class="comment-user">{{item.user.nickname}}</text>
                <text class="comment-time">{{item.time}}</text>
              </view>
              <text class="comment-text">{{item.content}}</text>
              <view class="comment-actions">
                <view class="like-button" bindtap="likeComment" data-id="{{item.id}}">
                  <image class="like-icon" src="/static/icons/like.svg"></image>
                  <text class="like-count">{{item.likes}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- è¯„è®ºè¾“å…¥æ¡† -->
        <view class="comment-input-section">
          <input class="comment-input" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." value="{{newComment}}" bindinput="inputComment" />
          <button class="comment-submit" bindtap="submitComment">å‘é€</button>
        </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="share-button" bindtap="toggleShareMenu">
        <image class="action-icon" src="/static/icons/share.svg"></image>
        <text>åˆ†äº«</text>
      </view>
      
      <block wx:if="{{activity.status === 'æŠ¥åä¸­'}}">
        <button class="enroll-button" wx:if="{{!isEnrolled}}" bindtap="enrollActivity">ç«‹å³æŠ¥å</button>
        <button class="cancel-button" wx:else bindtap="cancelEnroll">å–æ¶ˆæŠ¥å</button>
        <button class="reminder-button" bindtap="setActivityReminder">
          <text class="icon">{{hasReminder ? 'â°' : 'ğŸ””'}}</text>
          {{hasReminder ? 'å·²è®¾æé†’' : 'è®¾ç½®æé†’'}}
        </button>
      </block>
      
      <block wx:else>
        <button class="disabled-button">æ´»åŠ¨å·²ç»“æŸ</button>
        <button wx:if="{{isEnrolled}}" class="rating-button" bindtap="openRatingModal">è¯„ä»·æ´»åŠ¨</button>
      </block>
      
      <button class="checkin-button" wx:if="{{isEnrolled && activity.status === 'æŠ¥åä¸­'}}" bindtap="checkInActivity">æ´»åŠ¨ç­¾åˆ°</button>
    </view>
    
    <!-- åˆ†äº«èœå• -->
    <view class="share-menu {{showShareMenu ? 'show' : ''}}">
      <view class="share-menu-mask" bindtap="toggleShareMenu"></view>
      <view class="share-menu-content">
        <view class="share-menu-title">åˆ†äº«åˆ°</view>
        <view class="share-options">
          <button class="share-option" open-type="share">
            <image class="share-icon" src="/static/icons/wechat.svg"></image>
            <text>å¾®ä¿¡å¥½å‹</text>
          </button>
          <view class="share-option" bindtap="shareToMoments">
            <image class="share-icon" src="/static/icons/moments.svg"></image>
            <text>æœ‹å‹åœˆ</text>
          </view>
          <view class="share-option" bindtap="generatePoster">
            <image class="share-icon" src="/static/icons/poster.svg"></image>
            <text>ç”Ÿæˆæµ·æŠ¥</text>
          </view>
        </view>
        <button class="share-cancel" bindtap="toggleShareMenu">å–æ¶ˆ</button>
      </view>
    </view>
  </view>
  
  <!-- æ´»åŠ¨è¯„ä»·å¼¹çª— -->
  <view class="rating-modal {{showRatingModal ? 'show' : ''}}">
    <view class="rating-modal-mask" bindtap="closeRatingModal"></view>
    <view class="rating-modal-content">
      <view class="rating-modal-title">æ´»åŠ¨è¯„ä»·</view>
      <view class="rating-stars">
        <view class="star {{userRating >= 1 ? 'active' : ''}}" bindtap="setRating" data-rating="1">â˜…</view>
        <view class="star {{userRating >= 2 ? 'active' : ''}}" bindtap="setRating" data-rating="2">â˜…</view>
        <view class="star {{userRating >= 3 ? 'active' : ''}}" bindtap="setRating" data-rating="3">â˜…</view>
        <view class="star {{userRating >= 4 ? 'active' : ''}}" bindtap="setRating" data-rating="4">â˜…</view>
        <view class="star {{userRating >= 5 ? 'active' : ''}}" bindtap="setRating" data-rating="5">â˜…</view>
      </view>
      <textarea class="rating-textarea" placeholder="è¯·åˆ†äº«æ‚¨å¯¹æ´»åŠ¨çš„è¯„ä»·å’Œå»ºè®®..." value="{{userReview}}" bindinput="inputReview"></textarea>
      <view class="rating-buttons">
        <button class="rating-cancel" bindtap="closeRatingModal">å–æ¶ˆ</button>
        <button class="rating-submit" bindtap="submitRating">æäº¤è¯„ä»·</button>
      </view>
    </view>
  </view>
</view>